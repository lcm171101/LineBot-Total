# LINE æ¨æ’­ç®¡ç†ç³»çµ±

æœ¬ç³»çµ±ç‚ºä¸€å€‹ä½¿ç”¨ Flask + Firebase Firestore æ¶æ§‹çš„ LINE æ¨æ’­ç®¡ç†å¹³å°ï¼Œæä¾›å¾Œå°ç™»å…¥ã€ä½¿ç”¨è€…ç®¡ç†ã€æ¨æ’­æ¸¬è©¦åŠæ—¥èªŒæŸ¥è©¢ç­‰åŠŸèƒ½ã€‚

---

## ğŸ” ç™»å…¥èˆ‡é©—è­‰

- **ç™»å…¥é  `/login`**
  - ä½¿ç”¨å›ºå®šå¸³è™Ÿå¯†ç¢¼ï¼ˆ`lcm171101 / Mm60108511`ï¼‰ç™»å…¥ã€‚
- **ç™»å‡º `/logout`**
  - æ¸…é™¤ sessionã€‚
- **æ¬Šé™ä¿è­·**
  - æ‰€æœ‰ç®¡ç†åŠŸèƒ½éœ€ç™»å…¥ï¼ˆä½¿ç”¨ `@require_login` ä¿è­·ï¼‰ã€‚

---

## ğŸ‘¥ ä½¿ç”¨è€…/ç¾¤çµ„ç®¡ç† `/admin`

- é¡¯ç¤ºå·²å„²å­˜çš„ LINE user/group IDã€‚
- æ¯ç­†è³‡æ–™åŒ…å«ï¼š
  - ID
  - é¡å‹ï¼ˆuser/groupï¼‰
  - å°é–ç‹€æ…‹ï¼ˆâœ…/âŒï¼‰
  - æ›´æ–°æ™‚é–“
- æ“ä½œåŠŸèƒ½ï¼š
  - â• æ‰‹å‹•æ–°å¢ IDï¼ˆé¸æ“‡ user/groupï¼‰
  - ğŸ”’ å°é– IDï¼ˆ`/block/<uid>`ï¼‰
  - ğŸ”“ è§£é– IDï¼ˆ`/unblock/<uid>`ï¼‰
  - âŒ åˆªé™¤ IDï¼ˆ`/delete/<uid>`ï¼‰

---

## ğŸ“¤ æ¨æ’­æ¸¬è©¦ `/push-test`

- å¯æ¨æ’­è‡³ï¼š
  - å–®ä¸€ `user_id` æˆ– `group_id`
  - `all_users`
  - `all_groups`
- æ¨æ’­è¨Šæ¯é¡å‹ï¼š
  - `text`ï¼šæ–‡å­—è¨Šæ¯
  - `image`ï¼šåœ–ç‰‡ URL
- é¡¯ç¤ºæ¨æ’­çµæœï¼ˆæˆåŠŸ âœ… / å¤±æ•— âŒï¼‰

---

## ğŸ”§ å¯¦éš›æ¨æ’­ API `/push`

- ä½¿ç”¨ `LINE_CHANNEL_ACCESS_TOKEN` å‚³é€è¨Šæ¯ã€‚
- åˆ¤æ–·æ˜¯å¦å°é–ï¼Œæ±ºå®šæ˜¯å¦æ¨æ’­ã€‚
- æ”¯æ´æ ¼å¼ï¼š
  - `TextSendMessage`
  - `ImageSendMessage`

---

## ğŸ“ æ¨æ’­æ—¥èªŒ `/logs`

- é¡¯ç¤ºæœ€è¿‘ 100 ç­†æ¨æ’­ç´€éŒ„ï¼ˆ`push_log.txt`ï¼‰
- æ ¼å¼ç¯„ä¾‹ï¼š
  ```
  [2025-05-31 00:55:37] TO: Uxxxxxxxx TYPE: text CONTENT: Hello world
  ```

---

## ğŸ§± Firestore çµæ§‹ï¼ˆcollection: `line_sources`ï¼‰

| æ¬„ä½       | èªªæ˜             |
|------------|------------------|
| `type`     | "user" æˆ– "group" |
| `blocked`  | æ˜¯å¦å°é– (bool)   |
| `updated_at` | æ›´æ–°æ™‚é–“ (timestamp) |

---

## ğŸ“¦ å¥—ä»¶éœ€æ±‚ `requirements.txt`

```txt
flask
firebase-admin
gunicorn
requests
line-bot-sdk==2.4.1
```

---

## ğŸ“ å•Ÿå‹•æ–¹å¼

```bash
python app.py
# æˆ–éƒ¨ç½²åˆ° Render ä¸¦è¨­ç½®ç’°å¢ƒè®Šæ•¸ï¼š
# FIREBASE_KEY_B64 / LINE_CHANNEL_ACCESS_TOKEN
```

---